# 幂等性是什么意思
[参考文章](https://www.cnblogs.com/javalyy/p/8882144.html)
>HTTP/1.1中对幂等性的定义是：一次和多次请求某一个资源对于资源本身应该具有同样的结果（网络超时等问题除外）。也就是说，其任意多次执行对资源本身所产生的影响均与一次执行的影响相同。

简单来说，就是每次调用服务，同一方法不管重复操作同一资源多少次，产生的结果应该是相同的，比如删除一条记录，同一用户不管重复请求多少次，服务端应该都只进行过一次删除操作

## 常见场景
支付、分布式等场景，比如对一份订单的支付操作，用户短时间重复发起几次支付订单的操作，服务端支付的结果都是一样的，只会进行一次支付。分布式环境下，有可能出现服务端执行成功，但是返回结果时出现意外，导致客户端以为服务端操作失败而发起的重复请求。  

## SQL里的幂等性
以SQL为例，有下面三种场景，只有第三种场景需要开发人员使用其他策略保证幂等性：
```
SELECT col1 FROM tab1 WHER col2=2无论执行多少次都不会改变状态，是天然的幂等。

UPDATE tab1 SET col1=1 WHERE col2=2无论执行成功多少次状态都是一致的，因此也是幂等操作。

UPDATE tab1 SET col1=col1+1 WHERE col2=2每次执行的结果都会发生变化，这种不是幂等的。
```

## 常见幂等和防重策略
保证幂等性：需要定义唯一操作号这样的变量来记录当前的操作，然后每一次请求前都需要检查这个操作号id来确保操作只进行了一次
幂等性防重：为了保持幂等性，就需要将并行请求转变为串行方式来处理，通常就是加锁来实现，防止第一次操作还未写入操作号id时就被其它请求抢过执行权，导致其它请求误以为操作id未空而进行重复的操作